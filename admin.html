<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
</head>

<body>

<h1>Admin Panel</h1>

<input id="pass" type="password" placeholder="Admin Password">
<button id="loginBtn">Login</button>

<hr>

<div id="panel"></div>

<script>
const PASSWORD = "derinloverme";

let records = JSON.parse(localStorage.getItem("records")) || [];
let levels  = JSON.parse(localStorage.getItem("levels")) || [];

document.getElementById("loginBtn").addEventListener("click", login);

function login(){
  const passValue = document.getElementById("pass").value;
  const panel = document.getElementById("panel");

  if(passValue !== PASSWORD){
    alert("Wrong password");
    return;
  }

  let html = "<h2>Pending Records</h2>";

  if(records.length === 0){
    html += "<p>No records yet.</p>";
  } else {
    records.forEach((r,i)=>{
      html += `
        <div style="border:1px solid #aaa; padding:10px; margin:10px 0">
          <b>${r.nick}</b> â€” ${r.levelId} (${r.progress}%)
          <br>
          <a href="${r.yt}" target="_blank">YouTube</a> |
          <a href="${r.raw}" target="_blank">Raw</a>
          <br><br>
          ${r.approved ? "APPROVED" : `
            <button onclick="approve(${i})">Approve</button>
            <button onclick="reject(${i})">Reject</button>
          `}
        </div>
      `;
    });
  }

  html += `
    <hr>
    <h2>Add Level</h2>

    <input id="levelRank" placeholder="Rank"><br>
    <input id="levelId" placeholder="Level ID"><br>
    <input id="levelName" placeholder="Level Name"><br>
    <input id="levelCreator" placeholder="Creator"><br>
    <input id="levelPoints" placeholder="Points"><br><br>

    <button onclick="addLevel()">Add Level</button>

    <hr>
    <h2>Existing Levels</h2>
    <div id="levelList"></div>
  `;

  panel.innerHTML = html;
  renderLevels();
}

function approve(i){
  records[i].approved = true;

  const level = levels.find(l => l.id === records[i].levelId);
  if(!level) return alert("Level not found");

  let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

  let player = leaderboard.find(p => p.nick === records[i].nick);
  if(!player){
    player = { nick: records[i].nick, points: 0 };
    leaderboard.push(player);
  }

  player.points += level.points;

  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  localStorage.setItem("records", JSON.stringify(records));

  alert("Approved + points added");
  location.reload();
}

function reject(i){
  records.splice(i,1);
  localStorage.setItem("records", JSON.stringify(records));
  location.reload();
}

function addLevel(){
  const rank = levelRank.value;
  const id = levelId.value;
  const name = levelName.value;
  const creator = levelCreator.value;
  const points = levelPoints.value;

  if(!rank || !id || !name || !creator || !points){
    alert("All fields required");
    return;
  }

  levels.push({
    rank:Number(rank),
    id,
    name,
    creator,
    points:Number(points)
  });

  levels.sort((a,b)=>a.rank-b.rank);
  localStorage.setItem("levels", JSON.stringify(levels));

  alert("Level added");
  renderLevels();
}

function renderLevels(){
  const listDiv = document.getElementById("levelList");
  if(!listDiv) return;

  listDiv.innerHTML = "";

  levels.forEach((l,i)=>{
    listDiv.innerHTML += `
      <div>
        <b>#${l.rank}</b> ${l.name}
        <button onclick="deleteLevel(${i})">Delete</button>
      </div>
    `;
  });
}

function deleteLevel(i){
  if(!confirm("Delete level?")) return;

  const removed = levels.splice(i,1)[0];
  localStorage.setItem("levels", JSON.stringify(levels));

  records = records.filter(r => r.levelId !== removed.id);
  localStorage.setItem("records", JSON.stringify(records));

  location.reload();
}
</script>

</body>
</html>
