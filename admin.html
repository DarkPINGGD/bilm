<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
</head>

<body>

<h1>Admin Panel</h1>

<input id="pass" type="password" placeholder="Admin Password">
<button id="loginBtn">Login</button>

<hr>

<div id="panel"></div>

<script>
const PASSWORD = "1234";

let records = JSON.parse(localStorage.getItem("records")) || [];
let levels  = JSON.parse(localStorage.getItem("levels")) || [];

document.getElementById("loginBtn").addEventListener("click", login);

function login(){
  const passValue = document.getElementById("pass").value;
  const panel = document.getElementById("panel");

  if(passValue !== PASSWORD){
    alert("Wrong password");
    return;
  }

  let html = "<h2>Pending Records</h2>";

  if(records.length === 0){
    html += "<p>No records yet.</p>";
  } else {
    records.forEach((r,i)=>{
      html += `
        <div style="border:1px solid #aaa; padding:10px; margin:10px 0">
          <b>${r.nick}</b> — ${r.levelId} (${r.progress}%)
          <br>
          <a href="${r.yt}" target="_blank">YouTube</a> |
          <a href="${r.raw}" target="_blank">Raw</a>
          <br><br>
          ${r.approved ? "APPROVED" : `
            <button onclick="approve(${i})">Approve</button>
            <button onclick="reject(${i})">Reject</button>
          `}
        </div>
      `;
    });
  }

  html += `
    <hr>
    <h2>Add Level</h2>

    <input id="levelRank" placeholder="Rank (example: 23)"><br>
    <input id="levelId" placeholder="Level ID"><br>
    <input id="levelName" placeholder="Level Name"><br>
    <input id="levelCreator" placeholder="Creator"><br><br>
    <input id="levelPoints" placeholder="Points (example: 350)">
    <button onclick="addLevel()">Add Level</button>
  `;

  panel.innerHTML = html;
}

function approve(i){
  records[i].approved = true;

  // Level bul
  const level = levels.find(l => l.id === records[i].levelId);
  if(!level) return alert("Level not found");

  // Leaderboard oku
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

  // Oyuncu var mı?
  let player = leaderboard.find(p => p.nick === records[i].nick);

  if(!player){
    player = {
      nick: records[i].nick,
      points: 0,
      completed: [],
      firstVictories: []
    };
    leaderboard.push(player);
  }

  // Puan ekle
  player.points += level.points;

  // Completed ekle
  player.completed.push(level.name);

  // First Victor kontrol
  const approvedRecords = records.filter(r =>
    r.levelId === level.id && r.approved
  );

  if(approvedRecords.length === 1){
    player.firstVictories.push(level.name);
    records[i].isFirst = true;
  }

  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  localStorage.setItem("records", JSON.stringify(records));

  alert("Record approved + points added");
  location.reload();
}

}

function reject(i){
  records.splice(i,1);
  localStorage.setItem("records", JSON.stringify(records));
  alert("Record rejected");
  location.reload();
}

function addLevel(){
  const rank = document.getElementById("levelRank").value;
  const id = document.getElementById("levelId").value;
  const name = document.getElementById("levelName").value;
  const creator = document.getElementById("levelCreator").value;
  const points = document.getElementById("levelPoints").value;



  if(!rank || !id || !name || !creator){
    alert("All fields required");
    return;
  }

  levels.push({
    rank: Number(rank),
    id,
    name,
    creator
  });

  levels.sort((a,b)=>a.rank-b.rank);
  localStorage.setItem("levels", JSON.stringify(levels));

  alert("LEVEL ADDED SUCCESSFULLY");
}
</script>

</body>
</html>
